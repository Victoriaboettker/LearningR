---
title: "Reproducible documents"
author: "Victoria Bøttker"
format: html
editor: visual
---

```{r setup}
#| message: false
#| warning: false
library(tidyverse)
post_meal_data <- read_csv2(here::here("data/post-meal-insulin.csv"))

small_post_meal_data <- select(post_meal_data, id, Age, BMI, Group, auc_pg, auc_ins, glykemi)

tidier_post_meal_data <- small_post_meal_data |>
  rename(
    auc_glucose = auc_pg,
    auc_insulin = auc_ins
  ) |>
  filter(glykemi == 0) |>
  select(-glykemi)
tidier_post_meal_data

tidied_post_meal_data <- tidier_post_meal_data |>
  mutate(
    insulin_glucose_ratio = auc_insulin / auc_glucose,
    Group = if_else(Group == "CTR", "Control", "First-degree relative")
  )
```

## About me

-   Victoria Bøttker

-   Stud.med, Researh Year Student

-   Aarhus University

-   Aarhus University hospital, The department of Gynecology and Obstetrics

I am a 25-year-old **medical** student doing a research year at the department of Gynecology and obstetrics. The research is about threatened *preterm birth*.

## Simple code

```{r}
3*3
```

## Testing for Git 

The weather is medium. Not sunny, not rainy - but cloudy.

## Showing the data

```{r}
post_meal_data

```

```{r}
glimpse(post_meal_data)
```

## Plot one continous variable

```{r}
#| fig-cap: "Distribution of BMI."
#| label: fig-bmi-histo
ggplot(post_meal_data, aes(x = BMI)) + 
  geom_histogram()
```

## Exercise: discrete plots 

```{r}
#| fig-cap: "Group status after a meal."
#| label: fig-group-bar
ggplot(post_meal_data, aes(x = Group)) + 
  geom_bar()

```

@fig-group-bar

```{r}
#| fig-cap: "Distribution of glykemi."
#| label: fig-glykemi-bar
ggplot(post_meal_data, aes(x = glykemi)) + 
  geom_bar()
```

@fig-glykemi-bar

## Plotting two discrete variables 

```{r}
ggplot(post_meal_data, aes(x = Group, fill = as.character(glykemi)))+
  geom_bar(position = position_dodge())
```

## Side by side plots 

```{r}
ggplot(post_meal_data, aes(x = BMI)) + 
  geom_histogram()
```

```{r}
ggplot(post_meal_data, aes(x = glykemi)) + 
  geom_bar()
```

## Plotting two continuous variables 

```{r side-by-side-figs}
#| label: fig-bmi-glycemia
#| fig-cap: "BMI and glycemia, side by side."
#| fig-subcap:
#|   - "Distribution of BMI."
#|   - "Number of those with glycemia."
#| layout-ncol: 2
ggplot(post_meal_data, aes(x = BMI)) +
  geom_histogram()

ggplot(post_meal_data, aes(x = glykemi)) +
  geom_bar()

```

## Selecting data 

```{r}
select(post_meal_data, Age)
select(post_meal_data, Age, BMI, Weight)
select(post_meal_data, -Group)
```

## Select helpers

```{r}
select(post_meal_data, starts_with("PG"))
```

```{r}
select(post_meal_data, ends_with("DXA"))
```

```{r}
# All columns containing the number "0"
select(post_meal_data, contains("0"))
```

## Renaming columns

```{r}
small_post_meal_data |>
  rename(
    auc_glucose = auc_pg,
    auc_insulin = auc_ins
  )
```

##  

```{r}
# Task 1.
post_meal_data |>
  select(contains("OGTT"))

# Task 2.
post_meal_data |>
  select(contains(".."), -contains("...")) 

# Task 3.
post_meal_data |>
 rename(
    P.Glucose.minus5.OGTT = P.Glucose..5.OGTT,
    Insulin.minus5.OGTT.X = Insulin..5.OGTT.X
  )

# Task 4.
post_meal_data |>
  select(id, BMI, Length, Weight, Age) |>
  rename(Height = Length)
```

## Filtering data 

```{r}
small_post_meal_data |>
  filter(glykemi == 1)

```

This code could be read as:

Take the post_meal_data dataset and then filter sp that only rows where glykemi is equal to 1 are kept.

When a row in the glykemi column has the value 1, that row is kept. Otherwise, it is dropped.

Let's see how many people are above "overweight" (BMi of 25) category, which we would use \<= for.

```{r}
small_post_meal_data |>
  filter(BMI >= 25)
```

Let's see how many are in the "CTR" group again:

```{r}
small_post_meal_data |>
  filter(Group == "CTR")
```

```{r}
small_post_meal_data |>
  filter(Group == "CTR", BMI >= 25)
```

When we use , to separate our logic conditions in filter (), it interprets that as using an &. Looks like most of the people who are overweight are in the control group. Lets replace the , with an \| to see how many people are in the control group OR have a BMI of 25 or more.

```{r}
small_post_meal_data |>
  filter(Group == "CTR" | BMI >= 25)
```

This lists both people who are in the control as well as anyone who is overweight.

```{r}
tidier_post_meal_data
```

## Modifying columns 

```{r}
tidier_post_meal_data |>
  mutate(insulin_glucose_ratio = auc_insulin / auc_glucose)
```

```{r}
tidier_post_meal_data |>
  mutate(
    insulin_glucose_ratio = auc_insulin / auc_glucose,
    Group = if_else(Group == "CTR", "Control", "First-degree relative")
  )
```

```{r}
tidied_post_meal_data
```
